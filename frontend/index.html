<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DocChain | Verification Dashboard</title>

  <!-- stylesheet: served by Flask static (frontend is configured as static root) -->
  <link rel="stylesheet" href="/style.css">

  <!-- lucide icons (CDN) -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Expose backend base URL to the frontend JS -->
  <script>
    const API_BASE_URL = "{{ request.url_root[:-1] if request.url_root.endswith('/') else request.url_root }}";
    console.debug("API_BASE_URL =", API_BASE_URL);
  </script>
</head>
<body class="dark" data-default-mode="{{ default_mode or 'register' }}">
  <!-- Sidebar -->
  <aside class="sidebar" role="navigation" aria-label="Main navigation">
    <h2>DocChain</h2>
    <nav>
      <a class="nav-btn {% if active_page=='workflow' and default_mode=='verify' %}active{% endif %}"
         href="{{ url_for('verify_page') }}" aria-label="Open Verify page">
        <i data-lucide="file-check"></i> Verify
      </a>

      <a class="nav-btn {% if active_page=='workflow' and default_mode=='register' %}active{% endif %}"
         href="{{ url_for('register_page') }}" aria-label="Open Register page">
        <i data-lucide="file-plus-2"></i> Register
      </a>

      <a class="nav-btn {% if active_page=='history' %}active{% endif %}"
         href="{{ url_for('history_page') }}" aria-label="Open History page">
        <i data-lucide="clock-4"></i> History
      </a>

      <a class="nav-btn {% if active_page=='registry' %}active{% endif %}"
         href="{{ url_for('registry_page') }}" aria-label="Open Registry page">
        <i data-lucide="database"></i> Registry
      </a>

      <button class="nav-btn" id="themeToggle" aria-pressed="false" aria-label="Toggle theme">
        <i data-lucide="moon"></i> Theme
      </button>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="content" role="main">
    <header>
      <h1>Document Verification Dashboard</h1>
      <p>Register documents on Ethereum and verify their integrity using SHA-256 hashes.</p>
    </header>

    <!-- Stats Bar -->
    <section class="stats-bar" id="statsBar" aria-label="Statistics">
      <div class="stat-chip">
        <span class="stat-label">Total Documents</span>
        <span class="stat-value" id="statTotalDocs">â€“</span>
      </div>
      <div class="stat-chip">
        <span class="stat-label">Total Verifications</span>
        <span class="stat-value" id="statTotalVerifications">â€“</span>
      </div>
      <div class="stat-chip">
        <span class="stat-label">Last Updated</span>
        <span class="stat-value" id="statLastUpdated">â€“</span>
      </div>
    </section>

    <!-- ========== PAGE: WORKFLOW (Register / Verify) ========== -->
    <section id="page-workflow" class="page {% if active_page=='workflow' %}page-active{% endif %}">
      
      <!-- Action Tabs (Register / Verify) -->
      <div class="action-tabs">
        <button class="action-tab" data-target="register">
          <i data-lucide="file-plus-2"></i> Register
        </button>
        <button class="action-tab" data-target="verify">
          <i data-lucide="file-check"></i> Verify
        </button>
      </div>

      <!-- Upload Card -->
      <section class="upload-card" id="uploadCard" aria-label="Upload document">
        <div class="upload-area" id="uploadArea" tabindex="0" role="button" aria-label="Upload area. Click or drop files to upload">
          <i data-lucide="upload-cloud" class="upload-icon" aria-hidden="true"></i>
          <p>Drag &amp; Drop or <span id="browse" role="button" tabindex="0" aria-label="Browse files">browse</span> to upload</p>
          <input type="file" id="fileInput" hidden aria-hidden="true" />
        </div>

        <!-- File Info Display -->
        <div id="fileInfo" class="file-info"></div>

        <!-- File Preview -->
        <div class="file-preview" id="filePreview" aria-live="polite" aria-atomic="true"></div>

        <!-- Generated Hash + Copy -->
        <div class="generated-hash" aria-label="Generated hash">
          <label for="hashValue" class="visually-hidden">Generated Hash</label>
          <span class="generated-label">Generated Hash:</span>
          <code id="hashValue">N/A</code>
          <button id="copyHashBtn" type="button" aria-label="Copy generated hash">ðŸ“‹ Copy</button>
        </div>

        <!-- Owner input (for registration) -->
        <div class="file-owner">
          <label for="ownerInput" class="visually-hidden">Owner name (optional)</label>
          <input type="text" id="ownerInput" placeholder="Owner name (optional)" aria-label="Owner name (optional)">
        </div>

        <!-- Verify by ID input (shown in verify mode) -->
        <div id="registryIdRow" class="registry-id-row" style="display: none;">
          <label for="registryIdInput">Document ID (optional):</label>
          <input type="text" id="registryIdInput" placeholder="Enter document ID to verify">
        </div>

        <!-- Registered ID display (shown after registration) -->
        <div id="registeredIdRow" class="registered-id-row" style="display: none;">
          <label>Registered Document ID:</label>
          <code id="registeredIdText"></code>
          <button id="copyRegisteredIdBtn" type="button">ðŸ“‹ Copy</button>
          <button id="saveRegisteredIdBtn" type="button">ðŸ’¾ Save</button>
          <button id="useRegisteredIdBtn" type="button">âœ“ Use for Verify</button>
        </div>

        <!-- Blockchain Status -->
        <div id="bcStatus" class="bc-status"></div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button id="registerBtn" class="btn btn-primary">
            <i data-lucide="upload"></i> Register Document
          </button>
          <button id="verifyBtn" class="btn btn-secondary" style="display: none;">
            <i data-lucide="shield-check"></i> Verify Document
          </button>
        </div>

        <!-- Result Display -->
        <div id="result" class="result-card"></div>
      </section>
      <!-- end upload-card -->

    </section>
    <!-- end page-workflow -->

    <!-- ========== PAGE: HISTORY ========== -->
    <section id="page-history" class="page {% if active_page=='history' %}page-active{% endif %}">
      <h2>Verification History</h2>
      <div id="historyList" class="history-list">
        <p>Loading history...</p>
      </div>
    </section>

    <!-- ========== PAGE: REGISTRY ========== -->
    <section id="page-registry" class="page {% if active_page=='registry' %}page-active{% endif %}">
      <h2>Document Registry</h2>
      <div class="registry-table-wrapper">
        <table class="registry-table">
          <thead>
            <tr>
              <th>Document ID</th>
              <th>File Name</th>
              <th>Hash</th>
              <th>Blockchain Tx</th>
              <th>Timestamp</th>
            </tr>
          </thead>
          <tbody id="registryTableBody">
            <tr><td colspan="5">Loading registry...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

  </main>

  <!-- Loader -->
  <div id="loader" class="loader hidden">
    <div class="loader-spinner"></div>
    <p id="loaderText">Processing...</p>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Preview Modal -->
  <div id="previewModal" class="modal" style="display: none;">
    <div class="modal-content-wrapper">
      <span class="close">&times;</span>
      <div id="modalContent" class="modal-content"></div>
    </div>
  </div>

  <!-- app JS: served by Flask static root -->
  <script src="/script.js"></script>

  <!-- initialize lucide icons -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (window.lucide) {
        if (typeof lucide.createIcons === "function") {
          try { lucide.createIcons(); } catch (e) { console.warn("lucide.createIcons failed", e); }
        } else if (typeof lucide.replace === "function") {
          try { lucide.replace(); } catch (e) { console.warn("lucide.replace failed", e); }
        }
      }
    });
  </script>
</body>
</html>
